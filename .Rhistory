blad <- rbind(fblad,mblad)
head(blad)
# Antal observationer
N <- length(blad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(blad$events/N)
# Her defineres modellen:
analysis<-glm(events~exp(conc/1000)+age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
# Her defineres modellen:
analysis<-glm(events~conc+age+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
analysis2
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(blad$events, decreasing = TRUE),]
maxr <- 5
# Laver foreløbig test, tror det her er den rigtige måde at plotte det på
plot(round(prediction.data.original$pred,2),blad$events[order(blad$events, decreasing = TRUE)], xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
v = vector()
x = vector()
blad$events<- blad$events[order(blad$events, decreasing = TRUE)]
for (i in 1:length(prediction.data.original$pred)){
res <- mean(blad$events[0.1*(i-1) <= prediction.data.original$pred & prediction.data.original$pred < 0.1*i])
v = c(v,res)
x = c(x, 0.1*i)
}
plot(x, v, xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
# Frederik wd
setwd("C:\\Users\\frede\\OneDrive\\Dokumenter\\DTU\\4. Semester\\Fagprojekt\\ArsenikGit\\Data")
set.seed(69)
fblad <- read.table("fblad.sw.dat", header=TRUE)
mblad <- read.table("mblad.sw.dat", header=TRUE)
fblad$gender <- "Female"
mblad$gender <- "Male"
blad <- rbind(fblad,mblad)
head(blad)
# Antal observationer
N <- length(blad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(blad$events/N)
# Her defineres modellen:
analysis<-glm(events~conc+age+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3)+I(age^2))
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3)+I(age^3))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~exp(conc/1000)+age+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(exp(conc/1000)^2)+I(age^2))
summary(analysis2)
analysis2 <- update(analysis2, ~.+I(exp(conc/1000)^3)+I(age^3))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(exp(conc/1000)^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(exp(conc/1000)^3))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(exp(conc/1000)^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(exp(conc/1000)^3))
analysis2 <- update(analysis2, ~.+I(exp(conc/1000)^4))
analysis2 <- update(analysis2, ~.+I(exp(conc/1000)^5))
analysis2 <- update(analysis2, ~.+I(exp(conc/1000)^6))
analysis2 <- update(analysis2, ~.+I(exp(conc/1000)^7))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(exp(conc/1000)^2)+I(age^2))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(exp(conc/1000)^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(exp(conc/1000)^3))
summary(analysis2)
# Her defineres modellen:
analysis<-glm(events~conc+age+gender*conc*age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+age+gender*age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+gender*age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+gender*age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+age+gender*age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+gender*age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age*gender^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age*gender^2))
# Frederik wd
setwd("C:\\Users\\frede\\OneDrive\\Dokumenter\\DTU\\4. Semester\\Fagprojekt\\ArsenikGit\\Data")
set.seed(69)
fblad <- read.table("fblad.sw.dat", header=TRUE)
mblad <- read.table("mblad.sw.dat", header=TRUE)
fblad$gender <- "Female"
mblad$gender <- "Male"
blad <- rbind(fblad,mblad)
head(blad)
# Antal observationer
N <- length(blad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(blad$events/N)
# Her defineres modellen:
analysis<-glm(events~conc+gender*age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age*gender^2))
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I((age*gender)^2))
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2*gender))
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Her defineres modellen:
analysis<-glm(events~conc*gender*age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+gender+age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+gender+age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3)+I(age^3))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=mblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
analysis2 <- update(analysis2, ~.+I(conc^3)+I(age^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3)+I(age^3))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Her defineres modellen:
analysis<-glm(events~log(conc+1)+age,family=poisson(link=log),data=mblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(log(conc+1)^2)+I(age^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(age^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(age^2))
analysis2 <- update(analysis2, ~.+I(age^3))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(age^2))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~exp(conc/1000)+age,family=poisson(link=log),data=mblad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+age+age*conc,family=poisson(link=log),data=mblad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+age+age/conc,family=poisson(link=log),data=mblad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+age+age/at.risk,family=poisson(link=log),data=mblad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+age+age*at.risk,family=poisson(link=log),data=mblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(age^2)+I(conc^2)+I(age*at.risk^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(age^2)+I(conc^2))
summary(analysis2)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(age^2))
summary(analysis2)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=mblad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+age+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+age+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+age+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
# Transformerer dataen tilbage til original tilstand og sorterer data efter pred
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# Her defineres modellen:
analysis<-glm(events~conc+age+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(age^2)+I(conc^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(blad$events, decreasing = TRUE),]
maxr <- 5
# Laver foreløbig test, tror det her er den rigtige måde at plotte det på
plot(round(prediction.data.original$pred,2),blad$events[order(blad$events, decreasing = TRUE)], xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
v = vector()
x = vector()
blad$events<- blad$events[order(blad$events, decreasing = TRUE)]
for (i in 1:length(prediction.data.original$pred)){
res <- mean(blad$events[0.1*(i-1) <= prediction.data.original$pred & prediction.data.original$pred < 0.1*i])
v = c(v,res)
x = c(x, 0.1*i)
}
plot(x, v, xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
maxr <- 150
# Laver foreløbig test, tror det her er den rigtige måde at plotte det på
plot(round(prediction.data.original$pred,2),blad$events[order(blad$events, decreasing = TRUE)], xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
v = vector()
x = vector()
blad$events<- blad$events[order(blad$events, decreasing = TRUE)]
for (i in 1:length(prediction.data.original$pred)){
res <- mean(blad$events[0.1*(i-1) <= prediction.data.original$pred & prediction.data.original$pred < 0.1*i])
v = c(v,res)
x = c(x, 0.1*i)
}
plot(x, v, xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
lines(x,prediction.data.original$upper,col="red")
prediction.data.original$upper <- prediction.data.original$upper[order(blad$events, decreasing = TRUE)]
lines(x,prediction.data.original$upper,col="red")
plot(x, v, xlim=c(0, maxr), ylim=c(0, maxr))
lines(x,prediction.data.original$upper,col="red")
lines(0:maxr,0:maxr, type="l")
plot(x, v, xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(blad$events, decreasing = TRUE),]
lines(0.05:maxr,0:maxr, type="l")
lines(0.5:maxr,0:maxr, type="l")
lines(1:maxr,0:maxr, type="l")
lines(0:maxr,0:maxr, type="l")
lines(1:maxr,0:maxr, type="l")
lines(1:maxr,1:maxr, type="l")
lines(10:maxr,10:maxr, type="l")
lines(0:maxr+0.05,10:maxr, type="l")
plot(x, v, xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
prediction.data.original$upper
lines(0:maxr,0:maxr+prediction.data.original$upper, type="l")
lines(0:maxr+prediction.data.original$upper,0:maxr+prediction.data.original$upper, type="l")
lines(0:maxr+prediction.data.original$upper,0:maxr, type="l")
lines(0:maxr+mean(prediction.data.original$upper),0:maxr, type="l")
lines(0:maxr+mean(prediction.data.original$upper),0:maxr, type="l",col="red")
maxr <- 5
# Laver foreløbig test, tror det her er den rigtige måde at plotte det på
plot(round(prediction.data.original$pred,2),blad$events[order(blad$events, decreasing = TRUE)], xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
v = vector()
x = vector()
blad$events<- blad$events[order(blad$events, decreasing = TRUE)]
for (i in 1:length(prediction.data.original$pred)){
res <- mean(blad$events[0.1*(i-1) <= prediction.data.original$pred & prediction.data.original$pred < 0.1*i])
v = c(v,res)
x = c(x, 0.1*i)
}
prediction.data.original$upper
plot(x, v, xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr+mean(prediction.data.original$upper),0:maxr, type="l",col="red")
maxr <- 150
# Laver foreløbig test, tror det her er den rigtige måde at plotte det på
plot(round(prediction.data.original$pred,2),blad$events[order(blad$events, decreasing = TRUE)], xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
v = vector()
x = vector()
blad$events<- blad$events[order(blad$events, decreasing = TRUE)]
# Frederik wd
setwd("C:\\Users\\frede\\OneDrive\\Dokumenter\\DTU\\4. Semester\\Fagprojekt\\ArsenikGit\\Data")
set.seed(69)
fblad <- read.table("fblad.sw.dat", header=TRUE)
mblad <- read.table("mblad.sw.dat", header=TRUE)
fblad$gender <- "Female"
mblad$gender <- "Male"
blad <- rbind(fblad,mblad)
head(blad)
# Antal observationer
N <- length(blad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(blad$events/N)
# Her defineres modellen:
analysis<-glm(events~conc+age+gender,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
# Taylor udvider til ny analysis
analysis2 <- update(analysis, ~.+I(age^2)+I(conc^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
analysis2 <- update(analysis2, ~.+I(conc^4))
analysis2 <- update(analysis2, ~.+I(conc^5))
analysis2 <- update(analysis2, ~.+I(conc^6))
analysis2 <- update(analysis2, ~.+I(conc^7))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
analysis2
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(blad$events, decreasing = TRUE),]
maxr <- 150
# Laver foreløbig test, tror det her er den rigtige måde at plotte det på
plot(round(prediction.data.original$pred,2),blad$events[order(blad$events, decreasing = TRUE)], xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr,0:maxr, type="l")
v = vector()
x = vector()
blad$events<- blad$events[order(blad$events, decreasing = TRUE)]
for (i in 1:length(prediction.data.original$pred)){
res <- mean(blad$events[0.1*(i-1) <= prediction.data.original$pred & prediction.data.original$pred < 0.1*i])
v = c(v,res)
x = c(x, 0.1*i)
}
prediction.data.original$upper
plot(x, v, xlim=c(0, maxr), ylim=c(0, maxr))
lines(0:maxr+mean(prediction.data.original$upper),0:maxr, type="l",col="red")
lines(0:maxr,0:maxr, type="l")
analysis<-glm(events ~ s(conc) + s(age) + s(gender),family=poisson(link=log),data=blad,offset=log(at.risk))
analysis<-glm(events ~ conc + age + gender + age*conc,family=poisson(link=log),data=blad,offset=log(at.risk))
summary(analysis)
