lines(prediction.data$upper, fblad$events, col="red")
hist(log(fblad$events/fblad$at.risk))
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
lines(prediction.data.original$lower, fblad$events, col="red")
lines(prediction.data.original$upper, fblad$events, col="red")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original<-exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
#plot i log data
plot(prediction.data$pred, fblad$events[order(prediction.data$pred)], col="blue")
# Her defineres modellen:
analysis<-glm(events~conc+age+log(at.risk),family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original<-exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
lines(prediction.data.original$lower, fblad$events, col="red")
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc^2+age^2,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~conc+age+conc^2+age^2,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original<-exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Her defineres modellen:
analysis<-glm(events~conc+age+conc^2,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Her defineres modellen:
analysis<-glm(events~age+conc^2,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original<-exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
head(prediction.data.original)
head(fblad$events[order(prediction.data.original$pred)])
# Frederik wd
setwd("C:\\Users\\frede\\OneDrive\\Dokumenter\\DTU\\4. Semester\\Fagprojekt\\ArsenikGit\\Data")
fblad <- read.table("fblad.sw.dat", header=TRUE)
head(fblad)
# Antal observationer
N <- length(fblad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(fblad$events/N)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
lines(prediction.data.original$lower, fblad$events[order(prediction.data.original$pred)], col="red")
lines(prediction.data.original$upper, fblad$events[order(prediction.data.original$pred)], col="red")
#plot i log data
plot(prediction.data$pred, fblad$events[order(prediction.data$pred)], col="blue")
lines(prediction.data$lower, fblad$events, col="red")
lines(prediction.data$upper, fblad$events, col="red")
hist(log(fblad$events/fblad$at.risk))
cbind(fblad[fblad$events>4,] ,log(fblad$events/fblad$at.risk)[fblad$events > 4])
analysis2 <- update(analysis, ~.+I(conc^2) + I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3) + I(age^3))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred[prediction.data.original<4], fblad$events[prediction.data.original<4], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred[prediction.data.original$pred<4], fblad$events[prediction.data.original$pred<4], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred[prediction.data.original$pred<4], fblad$events[prediction.data.original$pred<4], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred[0<prediction.data.original$pred<4], fblad$events[0<prediction.data.original$pred<4], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred[prediction.data.original$pred<4], fblad$events[prediction.data.original$pred<4], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred[prediction.data.original$pred<4], fblad$events[prediction.data.original$pred<4], col="blue")
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred[prediction.data.original$pred<4], fblad$events[prediction.data.original$pred<4], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
?plot
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
lines(prediction.data.original$lower, fblad$events[order(prediction.data.original$pred)], col="red")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
head(fblad$events)
fblad$events
plot(fblad$events)
x <- c(1:559)
x
# plots i original data transformation
plot(x,prediction.data.original$pred, col="blue")
lines(x, fblad$events, col="red")
# plots i original data transformation
plot(x,prediction.data.original$pred, col="blue")
lines(x, fblad$events[order(prediction.data.original$pred)], col="red")
# plots i original data transformation
plot(x,log(prediction.data.original$pred), col="blue")
lines(x, log(fblad$events[order(prediction.data.original$pred)]), col="red")
# plots i original data transformation
plot(x,log(prediction.data.original$pred), col="blue")
# plots i original data transformation
plot(x,prediction.data$pred, col="blue")
lines(x,fblad$events[order(prediction.data.original$pred)], col="red")
lines(x,fblad$events, col="red")
# plots i original data transformation
plot(x,prediction.data$pred, col="blue")
lines(x,fblad$events, col="red")
# plots i original data transformation
plot(x,prediction.data.original$pred, col="blue")
lines(x,fblad$events, col="red")
plot(x,fblad$events, col="red")
lines(x,fblad$events, col="red")
# plots i original data transformation
plot(x,prediction.data.original$pred, col="blue")
lines(x,fblad$events, col="red")
# plots i original data transformation
plot(x,prediction.data$pred, col="blue")
# plots i original data transformation
plot(x,prediction.data.original$pred, col="blue")
# plots i original data transformation
plot(x,prediction.data$pred, col="blue")
# plots i original data transformation
plot(x,prediction.data.original$pred, col="blue")
# plots i original data transformation
plot(x,log(prediction.data.original$pred), col="blue")
plot(x, prediction.data$pred[order(prediction.data$pred)])
# plots i original data transformation
plot(x,log(prediction.data.original$pred), col="blue")
# plots i original data transformation
plot(log(prediction.data.original$pred), col="blue")
lines(x,fblad$events, col="red")
lines(x,log(fblad$events), col="red")
lines(x,fblad$events, col="red")
# plots i original data transformation
plot(log(prediction.data.original$pred, fblad$age^2), col="blue")
# plots i original data transformation
plot(log(prediction.data.original$pred, fblad$age), col="blue")
lines(fblad$events, fblad$age, col="red")
# plots i original data transformation
plot(log(prediction.data.original$pred), fblad$age, col="blue")
lines(fblad$events, fblad$age, col="red")
# plots i original data transformation
plot(log(prediction.data.original$pred), log(fblad$age), col="blue")
# plots i original data transformation
plot(log(prediction.data.original$pred), fblad$age, col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$age, col="blue")
lines(fblad$events, fblad$age, col="red")
# plots i original data transformation
plot(log(prediction.data.original$pred, fblad$age), col="blue")
# plots i original data transformation
plot(log(prediction.data.original$pred, fblad$events), col="blue")
# plots i original data transformation
plot(log(prediction.data.original$pred), fblad$events, col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
# plots i original data transformation
plot(log(prediction.data.original$pred), log(fblad$events), col="blue")
analysis2 <- update(analysis, ~.+I(conc^2) + I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3) + I(age^3))
summary(analysis2)
analysis2 <- update(analysis, ~.+I(conc^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
analysis2 <- update(analysis, ~.+I(conc^2))
#analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
analysis2 <- update(analysis2, ~.+I(conc^3)+I(age^3))
summary(analysis2)
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(log(prediction.data.original$pred), log(fblad$events), col="blue")
prediction.data.original <- exp(prediction.data)
# plots i original data transformation
plot(log(prediction.data.original$pred), log(fblad$events), col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
lines(prediction.data.original$lower, fblad$events], col="red")
lines(prediction.data.original$lower, fblad$events, col="red")
lines(prediction.data.original$upper, fblad$events, col="red")
fblad <- fblad[c(15:549), ]
# Antal observationer
N <- length(fblad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(fblad$events/N)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
lines(prediction.data.original$lower, fblad$events[order(prediction.data.original$pred)], col="red")
lines(prediction.data.original$upper, fblad$events[order(prediction.data.original$pred)], col="red")
#plot i log data
plot(prediction.data$pred, fblad$events[order(prediction.data$pred)], col="blue")
lines(prediction.data$lower, fblad$events, col="red")
lines(prediction.data$upper, fblad$events, col="red")
hist(log(fblad$events/fblad$at.risk))
cbind(fblad[fblad$events>4,] ,log(fblad$events/fblad$at.risk)[fblad$events > 4])
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
fblad <- read.table("fblad.sw.dat", header=TRUE)
head(fblad)
# Antal observationer
N <- length(fblad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(fblad$events/N)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
lines(prediction.data.original$lower, fblad$events[order(prediction.data.original$pred)], col="red")
lines(prediction.data.original$upper, fblad$events[order(prediction.data.original$pred)], col="red")
#plot i log data
plot(prediction.data$pred, fblad$events[order(prediction.data$pred)], col="blue")
lines(prediction.data$lower, fblad$events, col="red")
lines(prediction.data$upper, fblad$events, col="red")
hist(log(fblad$events/fblad$at.risk))
cbind(fblad[fblad$events>4,] ,log(fblad$events/fblad$at.risk)[fblad$events > 4])
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
#plot i log data
plot(prediction.data$pred, fblad$events[order(prediction.data$pred)], col="blue")
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
prediction.data.original <- exp(prediction.data)
prediction.data.original <- sort(prediction.data.original)
prediction.data.original <- sort(prediction.data.original[,])
prediction.data.original <- sort(prediction.data.original[1,])
# plots i original data transformation
plot(prediction.data.original, fblad$events, col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
prediction.data.original
prediction.data.original''
prediction.data.original$pred''
prediction.data.original$pred
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
prediction.data.original$pred
prediction.data.original
tail(prediction.data.original)
tail(fblad$events)
head(fblad$events)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred, decreasing = TRUE),]
tail(prediction.data.original)
head(fblad$events)
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
head(prediction.data.original)
prediction.data.original
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
lines(prediction.data.original$lower, fblad$events, col="red")
lines(prediction.data.original$upper, fblad$events, col="red")
fblad <- fblad[c(15:549), ]
# Antal observationer
N <- length(fblad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(fblad$events/N)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
lines(prediction.data.original$lower, fblad$events[order(prediction.data.original$pred)], col="red")
lines(prediction.data.original$upper, fblad$events[order(prediction.data.original$pred)], col="red")
#plot i log data
plot(prediction.data$pred, fblad$events[order(prediction.data$pred)], col="blue")
lines(prediction.data$lower, fblad$events, col="red")
lines(prediction.data$upper, fblad$events, col="red")
hist(log(fblad$events/fblad$at.risk))
cbind(fblad[fblad$events>4,] ,log(fblad$events/fblad$at.risk)[fblad$events > 4])
-----------------------------------------------------------------------------------------------------------------
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred, decreasing = TRUE),]
prediction.data.original
head(fblad$events)
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[15:559], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[c(15:559), ], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[c(15:559)], col="blue")
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[(15:559)], col="blue")
length(prediction.data.original)
length(prediction.data.original$pred)
length(fblad$events)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
-----------------------------------------------------------------------------------------------------------------
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred, decreasing = TRUE),]
prediction.data.original
head(fblad$events)
length(prediction.data.original$pred)
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred, decreasing = TRUE),]
prediction.data.original
head(fblad$events)
length(prediction.data.original$pred)
length(fblad$events)
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(fblad$events, decreasing = TRUE),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
fblad <- read.table("fblad.sw.dat", header=TRUE)
head(fblad)
# Antal observationer
N <- length(fblad$events)
# p.hat (empirisk sandsynlighed)
p.hat <- sum(fblad$events/N)
# Her defineres modellen:
analysis<-glm(events~conc+age,family=poisson(link=log),data=fblad,offset=log(at.risk))
summary(analysis)
# Hvor god er modellen
drop1(analysis, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(prediction.data.original$pred),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events[order(prediction.data.original$pred)], col="blue")
lines(prediction.data.original$lower, fblad$events[order(prediction.data.original$pred)], col="red")
lines(prediction.data.original$upper, fblad$events[order(prediction.data.original$pred)], col="red")
#plot i log data
plot(prediction.data$pred, fblad$events[order(prediction.data$pred)], col="blue")
lines(prediction.data$lower, fblad$events, col="red")
lines(prediction.data$upper, fblad$events, col="red")
hist(log(fblad$events/fblad$at.risk))
cbind(fblad[fblad$events>4,] ,log(fblad$events/fblad$at.risk)[fblad$events > 4])
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
analysis2 <- update(analysis, ~.+I(conc^2)+I(age^2))
#analysis2 <- update(analysis2, ~.+I(conc^3))
summary(analysis2)
# Hvor god er modellen
drop1(analysis2, test="Chisq")
# Laver signifikans niveauer
prediction.temp<-as.data.frame(predict(analysis2,se.fit=T))
prediction.data<-data.frame(pred=prediction.temp$fit, upper=prediction.temp$fit+ 1.96*prediction.temp$se.fit, lower=prediction.temp$fit-1.96*prediction.temp$se.fit)
prediction.data.original <- exp(prediction.data)
prediction.data.original <- prediction.data.original[order(fblad$events, decreasing = TRUE),]
# plots i original data transformation
plot(prediction.data.original$pred, fblad$events, col="blue")
hist(log(fblad$events/fblad$at.risk))
cbind(fblad[fblad$events>4,] ,log(fblad$events/fblad$at.risk)[fblad$events > 4])
